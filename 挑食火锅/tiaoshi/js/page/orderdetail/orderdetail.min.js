/*!
 * =====================================================
 * TS v1.0.0 ()
 * =====================================================
 */
!function(a,b){b.OrderdetailPage=b.UserPage.extend({params:{},orderData:{},payChannels:["未选择","现金支付","Pos刷卡","支付宝","微信支付","银联支付"],initConfig:function(){b.backUrl="../order/order.html",document.location.search&&(this.params=b.parseParams(document.location.search)),b.Payment=new b.PaymentClass(b.data.payment),template.helper("priceFormat",function(a){return parseFloat(a).toFixed(2)})},initPage:function(a){this._super();var b=parseInt(this.params.id);if(b){var c=this;this.initPullRefresh(),setTimeout(function(){c.refreshCallback()},1e3)}},refreshCallback:function(){},initPullRefresh:function(){var c,d=this,e=(document.getElementById("tpl"),a("#pullrefresh")),c=e.pullRefresh({indicators:!1,down:{callback:function(){b.Api.get_order_detail(d.params.id,function(a){var e=d.orderData=a.data,f="";1==e.pay_way&&(f=d.payChannels[parseInt(e.pay_channel)]),b.template("orderdetail","orderdetail/orderdetail",{orderData:e,pay_channel:f}),document.getElementById("ts_order_follow").setAttribute("data-href","../ordertrack/ordertrack.html?id="+e.order_no+"&code="+e.order_code),1==e.order_status?document.getElementById("ts_order_pay").classList.remove("mui-hidden"):document.getElementById("ts_order_follow").classList.remove("mui-hidden"),31!=e.order_status&&document.getElementById("ts_order_cancel").classList.remove("mui-hidden"),c.endPulldownToRefresh()})}}});c.pulldownLoading(0)},initEvent:function(){var a=this;document.getElementById("ts_order_cancel").addEventListener("tap",function(){a.cancelOrder()}),document.getElementById("ts_order_pay").addEventListener("tap",function(){var c=a.params.id,d=a.orderData.order_sum;b.Payment.payAction(function(e){if(e!==!1){var f=0;"alipay"===e?f=3:"wxpay"===e&&(f=4),b.showWaiting(),b.Api.set_order_pay_way(b.User.get_user_id(),c,f,1,function(){b.Payment.pay(e,{order_no:c,total:d,user_ip:"118.194.218.74"},function(c){a.initPage(),b.closeWaiting()})})}})})},cancelOrder:function(){if(b.User.isLogin()){var c=this;b.confirm("是否删除当前订单?",function(d){d&&(b.showWaiting(),b.Api.cancel_order(b.User.get_user_id(),c.params.id,function(a){b.closeWaiting(),c.back()},a.noop))})}},back:function(){a.back()}})}(mui,TS),function(a,b){a.os.plus&&(b.OrderdetailPage=b.OrderdetailPage.extend({refreshCallback:function(){a.plusReady(function(){var a=plus.webview.getWebviewById("confirmorder");a&&a.close("none")})},back:function(){a.plusReady(function(){var c=plus.webview.currentWebview().opener();c&&b.debug&&b.d(c.id),c&&"order"===c.id&&a.fire(c,"order_refresh"),a.back()})}}))}(mui,TS);