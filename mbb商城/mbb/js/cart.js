var Cart={addProduct:function(c,b,a,d){mui.sendRequest(mui.constMap.ROOT_PATH+"/cart/create",{session:user.session,goods_id:c,number:b,spec:a.join(",")},function(e){if(!e.status.succeed){mui.toast(e.status.error_desc);return}var f=plus.webview.getLaunchWebview();mui.fire(f,"cart",{total:e.data.goods_number});if(d){d(e.data)}})},addExchange:function(b,a,c){mui.sendRequest(mui.constMap.ROOT_PATH+"/exchange/buy",{session:user.session,goods_id:b,spec:a.join(",")},function(d){if(!d.status.succeed){mui.toast(d.status.error_desc);return}var e=plus.webview.getLaunchWebview();mui.fire(e,"cart",{total:d.data.goods_number});if(c){c(d.data)}})},changeBar:function(d,g,b,a,j){var h=b.parentNode,f=h.querySelector("input");var e=0;if(d=="+"){e=1}if(d=="-"){e=-1}var c=parseInt(f.value);if(c+e<0){mui.toast("您输入的数字已经超出的最小值！");return}var i=f.getAttribute("max")*1;c=c+e;if(c>i){c=i;if(c<0){c=0}mui.alert("已达到最大库存")}f.value=c;this.changeProductCount(g,f.value,f,a,j)},changeProductCount:function(a,b,d,e,c){if(b==0){this.removeProductOnShoppingCart(a,d,c);return}(function(f){f.sendRequest(f.constMap.ROOT_PATH+"/cart/update",{session:user.session,rec_id:a,new_number:b},function(g){if(!g.status.succeed){f.toast(g.status.error_desc);return}var i=plus.webview.getLaunchWebview();mui.fire(i,"cart",{total:g.data.goods_number});if(e){e(g.data)}});d.value=b})(mui)},removeProductOnShoppingCart:function(a,b,c){(function(d){d.confirm("确定不购买该商品？","温馨提示",["是","否"],function(f){if(f.index==0){d.sendRequest(d.constMap.ROOT_PATH+"/cart/delete",{session:user.session,rec_id:a},function(e){if(!e.status.succeed){d.toast(e.status.error_desc);b.value=1;return}var g=plus.webview.getLaunchWebview();mui.fire(g,"cart",{total:e.data.goods_number});if(c){c(e.data,b)}})}else{b.value=1}})})(mui)},clearCart:function(a){(function(b){b.sendRequest(b.constMap.ROOT_PATH+"/cart/clear",{session:user.session},function(c){if(!c.status.succeed){b.toast(c.status.error_desc);return}var d=plus.webview.getLaunchWebview();mui.fire(d,"cart",{total:0});if(a){a(c.data)}})})(mui)},get:function(a){mui.sendRequest(mui.constMap.ROOT_PATH+"/cart/list",{session:user.session,config:{silence:true}},function(b){if(!b.status.succeed){hideCart();mui.toast(b.status.error_desc);return}var c=plus.webview.getLaunchWebview();mui.fire(c,"cart",{total:b.data.total.goods_number});if(a){a(b.data)}})},checkOrder:function(a){mui.sendRequest(mui.constMap.ROOT_PATH+"/flow/checkOrder",{session:user.session,config:{silence:true}},function(b){if(!b.status.succeed){mui.toast(b.status.error_desc);return}if(a){a(b.data)}})},toOrder:function(b,c,a,d){mui.sendRequest(mui.constMap.ROOT_PATH+"/flow/done",{session:user.session,pay_id:b,shipping_id:c,bonus_id:a},function(e){if(!e.status.succeed){mui.toast(e.status.error_desc);return}var f=plus.webview.getLaunchWebview();mui.fire(f,"cart",{total:0});if(d){d(e.data)}})},getSession:function(a){mui.sendRequest(mui.constMap.ROOT_PATH+"/session",{config:{silence:true}},function(b){if(!b.status.succeed){mui.toast(b.status.error_desc);return}console.log("获得Session: "+JSON.stringify(b.data));user.session=b.data;if(a){a()}})},init:function(){if(!user){user={session:null}}}};