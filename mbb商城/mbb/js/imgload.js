var img_translate="images/translate.png";var taskArr=new Array();var isStartTask=false;function load(d){if(d.getAttribute("data-loaded")){return}var e=d.getAttribute("data-src");if(!e){return}var c="_downloads/image/"+md5(e)+".jpg";var a=plus.io.convertLocalFileSystemURL(c);var b=new Image();b.src=a;b.onload=function(){console.log("已存在,直接显示=="+c);setLoaded(d,a)};b.onerror=function(){console.log("不存在=="+c);var f=new Image();f.onload=function(){setLoaded(d,e)};f.src=e;d.setAttribute("hb_path",c);d.setAttribute("sd_path",a);taskArr.push(d);if(!isStartTask){isStartTask=true;startTask()}}}function startTask(){if(taskArr.length==0){isStartTask=false;return}var d=taskArr.shift();var e=d.getAttribute("data-src");var c=d.getAttribute("hb_path");var a=d.getAttribute("sd_path");console.log("从任务集合中取一个任务=="+c);var b=new Image();b.src=a;b.onload=function(){console.log("已下载则跳过=="+c);startTask()};b.onerror=function(){var f=plus.downloader.createDownload(e,{filename:c,timeout:10,retry:2},function(h,g){console.log("下载回调status=="+g+"-->"+c);if(g==200){setLoaded(d,a)}else{delFile(c);h.abort()}startTask()});f.start()}}function setLoaded(a,b){if(a.getAttribute("data-loaded")){return}a.classList.add("anim_opacity");a.setAttribute("data-loaded",true);a.setAttribute("src",b)}function delFile(a){if(a){plus.io.resolveLocalFileSystemURL(a,function(b){b.remove(function(c){console.log("文件删除成功=="+a)},function(c){console.log("文件删除失败="+a)})})}};